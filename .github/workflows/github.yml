name: GitHub üîé
run-name: GitHub repository check

on:
  schedule:
    - cron: "0 0 * * 0"

permissions: {}

env:
  environment: base
  timezone: ${{ vars.TIMEZONE }}

jobs:
  setup:
    name: Infrastructure üîß
    runs-on: ["ubuntu-latest"]
    outputs:
      environment: ${{ env.environment }}
      timezone: ${{ env.timezone }}
    steps:
      - name: Environment üß™
        run: echo "Environment set to ${{ env.environment }}"

      - name: Timezone üåê
        run: echo "Timezone set to ${{ env.timezone }}"
  archive:
    permissions:
      contents: read

    name: Archive ‚öôÔ∏è
    runs-on: ["ubuntu-latest"]
    needs: setup
    environment:
      name: ${{ needs.setup.outputs.environment }}

    steps:
      - name: Repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Archive
        uses: ministryofjustice/devsecops-actions/github/repository/archive@0518a21b6c0b76d397609feaceaf1820bfe4f401
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          archival-days: 30
          notification-email: "${{ vars.PANDA_NOTIFICATION_EMAIL }}"
          gov-notify-key: "${{ secrets.PANDA_GOV_NOTIFY_KEY }}"
          gov-notify-template-id: "${{ vars.ARCHIVAL_GOV_NOTIFY_TEMPLATE_ID }}"
